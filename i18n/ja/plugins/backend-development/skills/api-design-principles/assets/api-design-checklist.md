# API設計チェックリスト

## 実装前レビュー

### リソース設計
- [ ] リソースは動詞ではなく名詞である
- [ ] コレクションには複数形の名前
- [ ] すべてのエンドポイントで一貫した命名
- [ ] 明確なリソース階層(深いネスト >2レベルを避ける)
- [ ] すべてのCRUD操作がHTTPメソッドに適切にマップされている

### HTTPメソッド
- [ ] 取得にはGET(安全、冪等)
- [ ] 作成にはPOST
- [ ] 完全置換にはPUT(冪等)
- [ ] 部分更新にはPATCH
- [ ] 削除にはDELETE(冪等)

### ステータスコード
- [ ] 成功したGET/PATCH/PUTには200 OK
- [ ] POSTには201 Created
- [ ] DELETEには204 No Content
- [ ] 不正な形式のリクエストには400 Bad Request
- [ ] 認証がないには401 Unauthorized
- [ ] 権限不足には403 Forbidden
- [ ] リソースが見つからないには404 Not Found
- [ ] バリデーションエラーには422 Unprocessable Entity
- [ ] レート制限には429 Too Many Requests
- [ ] サーバー問題には500 Internal Server Error

### ページネーション
- [ ] すべてのコレクションエンドポイントがページネーションされている
- [ ] デフォルトページサイズが定義されている(例: 20)
- [ ] 最大ページサイズが強制されている(例: 100)
- [ ] ページネーションメタデータが含まれている(合計、ページ数など)
- [ ] カーソルベースまたはオフセットベースパターンが選択されている

### フィルタリングとソート
- [ ] フィルタリング用のクエリパラメータ
- [ ] ソートパラメータがサポートされている
- [ ] 全文検索用の検索パラメータ
- [ ] フィールド選択がサポートされている(スパースフィールドセット)

### バージョニング
- [ ] バージョニング戦略が定義されている(URL/ヘッダー/クエリ)
- [ ] すべてのエンドポイントにバージョンが含まれている
- [ ] 非推奨ポリシーが文書化されている

### エラー処理
- [ ] 一貫したエラーレスポンス形式
- [ ] 詳細なエラーメッセージ
- [ ] フィールドレベルのバリデーションエラー
- [ ] クライアント処理用のエラーコード
- [ ] エラーレスポンスのタイムスタンプ

### 認証と認可
- [ ] 認証方式が定義されている(Bearerトークン、APIキー)
- [ ] すべてのエンドポイントで認可チェック
- [ ] 401 vs 403が正しく使用されている
- [ ] トークン有効期限が処理されている

### レート制限
- [ ] エンドポイント/ユーザーごとのレート制限が定義されている
- [ ] レート制限ヘッダーが含まれている
- [ ] 制限超過には429ステータスコード
- [ ] Retry-Afterヘッダーが提供されている

### ドキュメント
- [ ] OpenAPI/Swagger仕様が生成されている
- [ ] すべてのエンドポイントが文書化されている
- [ ] リクエスト/レスポンス例が提供されている
- [ ] エラーレスポンスが文書化されている
- [ ] 認証フローが文書化されている

### テスト
- [ ] ビジネスロジックのユニットテスト
- [ ] エンドポイントの統合テスト
- [ ] エラーシナリオがテストされている
- [ ] エッジケースがカバーされている
- [ ] 重いエンドポイントのパフォーマンステスト

### セキュリティ
- [ ] すべてのフィールドで入力検証
- [ ] SQLインジェクション防止
- [ ] XSS防止
- [ ] CORSが正しく設定されている
- [ ] HTTPSが強制されている
- [ ] URLに機密データがない
- [ ] レスポンスに秘密がない

### パフォーマンス
- [ ] データベースクエリが最適化されている
- [ ] N+1クエリが防止されている
- [ ] キャッシング戦略が定義されている
- [ ] キャッシュヘッダーが適切に設定されている
- [ ] 大きなレスポンスがページネーションされている

### 監視
- [ ] ログが実装されている
- [ ] エラー追跡が設定されている
- [ ] パフォーマンスメトリクスが収集されている
- [ ] ヘルスチェックエンドポイントが利用可能
- [ ] エラーのアラートが設定されている

## GraphQL固有のチェック

### スキーマ設計
- [ ] スキーマファーストアプローチが使用されている
- [ ] 型が適切に定義されている
- [ ] Non-null vs nullableが決定されている
- [ ] インターフェース/ユニオンが適切に使用されている
- [ ] カスタムスカラーが定義されている

### クエリ
- [ ] クエリ深度制限
- [ ] クエリ複雑性分析
- [ ] DataLoaderがN+1を防止
- [ ] ページネーションパターンが選択されている(Relay/offset)

### ミューテーション
- [ ] 入力型が定義されている
- [ ] エラーを持つペイロード型
- [ ] 楽観的レスポンスサポート
- [ ] 冪等性が考慮されている

### パフォーマンス
- [ ] すべての関係にDataLoader
- [ ] クエリバッチングが有効
- [ ] 永続化クエリが考慮されている
- [ ] レスポンスキャッシングが実装されている

### ドキュメント
- [ ] すべてのフィールドが文書化されている
- [ ] 非推奨がマークされている
- [ ] 例が提供されている
- [ ] スキーマイントロスペクションが有効
