専門化されたレビューエージェントを使用した多次元包括コードレビューのオーケストレーション

[拡張思考: このワークフローは、複数の専門化されたエージェントを順次フェーズでオーケストレーションすることで、徹底的なコードレビューを実施します。各フェーズは前回の発見に基づいて構築され、コード品質、セキュリティ、パフォーマンス、テスト、ドキュメンテーション、ベストプラクティスをカバーする包括的なレビューを作成します。このワークフローは、モダンAI支援レビューツール、静的解析、セキュリティスキャン、自動品質メトリクスを統合します。結果は、明確な優先順位付けと修復ガイダンスを備えた実行可能なフィードバックに統合されます。フェーズ別アプローチにより、適切な場合は並列エージェント実行により効率性を維持しながら、徹底的なカバレッジを確保します。]

## レビュー設定オプション

- **--security-focus**: セキュリティ脆弱性とOWASPコンプライアンスを優先
- **--performance-critical**: パフォーマンスボトルネックとスケーラビリティ問題を強調
- **--tdd-review**: TDDコンプライアンスとテストファースト検証を含む
- **--ai-assisted**: AI駆動レビューツール（Copilot、Codium、Bito）を有効化
- **--strict-mode**: 重大な問題が見つかった場合、レビューを失敗させる
- **--metrics-report**: 詳細な品質メトリクスダッシュボードを生成
- **--framework [name]**: フレームワーク固有のベストプラクティスを適用（React、Spring、Djangoなど）

## フェーズ1: コード品質とアーキテクチャレビュー

Taskツールを使用して品質とアーキテクチャエージェントを並列でオーケストレーション:

### 1A. コード品質分析
- Taskツールをsubagent_type="code-reviewer"で使用
- プロンプト: "$ARGUMENTSの包括的なコード品質レビューを実施してください。コード複雑度、保守性指数、技術的負債、コード重複、命名規則、クリーンコード原則への準拠を分析してください。静的解析のためにSonarQube、CodeQL、Semgrepと統合してください。コード臭、アンチパターン、SOLID原則違反をチェックしてください。循環的複雑度メトリクスを生成し、リファクタリング機会を特定してください。"
- 期待される出力: 品質メトリクス、コード臭インベントリ、リファクタリング推奨事項
- コンテキスト: 初期コードベース分析、他のフェーズへの依存なし

### 1B. アーキテクチャと設計レビュー
- Taskツールをsubagent_type="architect-review"で使用
- プロンプト: "$ARGUMENTSのアーキテクチャ設計パターンと構造的整合性をレビューしてください。マイクロサービス境界、API設計、データベーススキーマ、依存関係管理、ドメイン駆動設計原則への準拠を評価してください。循環依存、不適切な結合、不足している抽象化、アーキテクチャドリフトをチェックしてください。エンタープライズアーキテクチャ標準とクラウドネイティブパターンへのコンプライアンスを検証してください。"
- 期待される出力: アーキテクチャ評価、設計パターン分析、構造的推奨事項
- コンテキスト: コード品質分析と並列実行

## フェーズ2: セキュリティとパフォーマンスレビュー

Taskツールをセキュリティとパフォーマンスエージェントで使用し、フェーズ1の発見を組み込む:

### 2A. セキュリティ脆弱性評価
- Taskツールをsubagent_type="security-auditor"で使用
- プロンプト: "$ARGUMENTSの包括的セキュリティ監査を実行してください。OWASP Top 10分析、Snyk/Trivyによる依存関係脆弱性スキャン、GitLeaksによるシークレット検出、入力検証レビュー、認証/認可評価、暗号化実装レビューを実施してください。フェーズ1アーキテクチャレビューの発見を含めてください: {phase1_architecture_context}。SQLインジェクション、XSS、CSRF、安全でないデシリアライゼーション、設定セキュリティ問題をチェックしてください。"
- 期待される出力: 脆弱性レポート、CVEリスト、セキュリティリスクマトリクス、修復ステップ
- コンテキスト: フェーズ1Bで特定されたアーキテクチャ脆弱性を組み込む

### 2B. パフォーマンスとスケーラビリティ分析
- Taskツールをsubagent_type="application-performance::performance-engineer"で使用
- プロンプト: "$ARGUMENTSのパフォーマンス分析とスケーラビリティ評価を実施してください。CPU/メモリホットスポットのコードプロファイル、データベースクエリパフォーマンス分析、キャッシング戦略レビュー、N+1問題の特定、コネクションプーリング評価、非同期処理パターン評価を行ってください。フェーズ1のアーキテクチャ発見を考慮してください: {phase1_architecture_context}。メモリリーク、リソース競合、負荷時のボトルネックをチェックしてください。"
- 期待される出力: パフォーマンスメトリクス、ボトルネック分析、最適化推奨事項
- コンテキスト: アーキテクチャインサイトを使用してシステム的なパフォーマンス問題を特定

## フェーズ3: テストとドキュメンテーションレビュー

Taskツールをテストとドキュメンテーション品質評価に使用:

### 3A. テストカバレッジと品質分析
- Taskツールをsubagent_type="unit-testing::test-automator"で使用
- プロンプト: "$ARGUMENTSのテスト戦略と実装を評価してください。単体テストカバレッジ、統合テスト完全性、エンドツーエンドテストシナリオ、テストピラミッド準拠、テスト保守性を分析してください。アサーション密度、テスト分離、モック使用、不安定性を含むテスト品質メトリクスをレビューしてください。フェーズ2のセキュリティとパフォーマンステスト要件を考慮してください: {phase2_security_context}、{phase2_performance_context}。--tdd-reviewフラグが設定されている場合、TDDプラクティスを検証してください。"
- 期待される出力: カバレッジレポート、テスト品質メトリクス、テストギャップ分析
- コンテキスト: フェーズ2のセキュリティとパフォーマンステスト要件を組み込む

### 3B. ドキュメンテーションとAPI仕様レビュー
- Taskツールをsubagent_type="code-documentation::docs-architect"で使用
- プロンプト: "$ARGUMENTSのドキュメンテーション完全性と品質をレビューしてください。インラインコードドキュメンテーション、APIドキュメンテーション（OpenAPI/Swagger）、アーキテクチャ決定記録（ADR）、README完全性、デプロイメントガイド、ランブックを評価してください。すべての前のフェーズ発見に基づいて、ドキュメンテーションが実際の実装を反映していることを検証してください: {phase1_context}、{phase2_context}。古いドキュメンテーション、不足している例、不明確な説明をチェックしてください。"
- 期待される出力: ドキュメンテーションカバレッジレポート、不一致リスト、改善推奨事項
- コンテキスト: すべての前の発見を相互参照してドキュメンテーション精度を確保

## フェーズ4: ベストプラクティスと標準コンプライアンス

Taskツールを使用してフレームワーク固有と業界ベストプラクティスを検証:

### 4A. フレームワークと言語ベストプラクティス
- Taskツールをsubagent_type="framework-migration::legacy-modernizer"で使用
- プロンプト: "$ARGUMENTSのフレームワークと言語ベストプラクティスへの準拠を検証してください。モダンJavaScript/TypeScriptパターン、React hooksベストプラクティス、Python PEPコンプライアンス、Javaエンタープライズパターン、Goイディオマティックコード、またはフレームワーク固有の規約（--frameworkフラグに基づく）をチェックしてください。パッケージ管理、ビルド設定、環境処理、デプロイメントプラクティスをレビューしてください。前のフェーズのすべての品質問題を含めてください: {all_previous_contexts}。"
- 期待される出力: ベストプラクティスコンプライアンスレポート、近代化推奨事項
- コンテキスト: フレームワーク固有のガイダンスのためのすべての前の発見を統合

### 4B. CI/CDとDevOpsプラクティスレビュー
- Taskツールをsubagent_type="cicd-automation::deployment-engineer"で使用
- プロンプト: "$ARGUMENTSのCI/CDパイプラインとDevOpsプラクティスをレビューしてください。ビルド自動化、テスト自動化統合、デプロイメント戦略（ブルーグリーン、カナリア）、Infrastructure as Code、監視/可観測性セットアップ、インシデント対応手順を評価してください。パイプラインセキュリティ、アーティファクト管理、ロールバック機能を評価してください。デプロイメントに影響する前のフェーズで特定されたすべての問題を考慮してください: {all_critical_issues}。"
- 期待される出力: パイプライン評価、DevOps成熟度評価、自動化推奨事項
- コンテキスト: 特定されたすべての問題の修正の運用化に焦点を当てる

## 統合レポート生成

すべてのフェーズ出力を包括的レビューレポートにコンパイル:

### 重大な問題（P0 - 直ちに修正が必要）
- CVSS > 7.0のセキュリティ脆弱性
- データ損失または破損リスク
- 認証/認可バイパス
- 本番安定性への脅威
- コンプライアンス違反（GDPR、PCI DSS、SOC2）

### 高優先度（P1 - 次のリリース前に修正）
- ユーザー体験に影響を与えるパフォーマンスボトルネック
- 重要なテストカバレッジの欠落
- 技術的負債を引き起こすアーキテクチャアンチパターン
- 既知の脆弱性を持つ古い依存関係
- 保守性に影響するコード品質問題

### 中優先度（P2 - 次のスプリントで計画）
- 非重大なパフォーマンス最適化
- ドキュメンテーションのギャップと不一致
- コードリファクタリング機会
- テスト品質改善
- DevOps自動化強化

### 低優先度（P3 - バックログで追跡）
- スタイルガイド違反
- 軽微なコード臭問題
- あれば良いドキュメンテーション更新
- 表面的改善

## 成功基準

以下の場合、レビューは成功とみなされます:
- すべての重大なセキュリティ脆弱性が特定され文書化されている
- パフォーマンスボトルネックが修復パスとともにプロファイルされている
- テストカバレッジのギャップが優先度推奨事項とともにマッピングされている
- アーキテクチャリスクが軽減戦略とともに評価されている
- ドキュメンテーションが実際の実装状態を反映している
- フレームワークベストプラクティスコンプライアンスが検証されている
- CI/CDパイプラインがレビュー済みコードの安全なデプロイメントをサポートしている
- すべての発見に対して明確で実行可能なフィードバックが提供されている
- メトリクスダッシュボードが改善トレンドを示している
- チームが修復のための明確な優先順位付けされたアクションプランを持っている

ターゲット: $ARGUMENTS
