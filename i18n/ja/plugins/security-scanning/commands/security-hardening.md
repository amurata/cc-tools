> **[English](../../../plugins/security-scanning/commands/security-hardening.md)** | **日本語**

協調的なマルチエージェントオーケストレーションによる多層防御戦略を通じて包括的なセキュリティ強化を実装します。

[拡張思考: このワークフローは、すべてのアプリケーション層にわたる多層防御セキュリティ戦略を実装します。専門的なセキュリティエージェントを調整して包括的な評価を実施し、多層セキュリティ制御を実装し、継続的なセキュリティ監視を確立します。このアプローチは、シフトレフトセキュリティ、自動スキャン、コンプライアンス検証を伴う最新のDevSecOps原則に従います。各フェーズは以前の発見に基づいて構築され、現在の脆弱性と将来の脅威の両方に対処するレジリエントなセキュリティ体制を作成します。]

## フェーズ1: 包括的なセキュリティ評価

### 1. 初期脆弱性スキャン
- subagent_type="security-auditor"でTaskツールを使用
- プロンプト: 「$ARGUMENTSに対して包括的なセキュリティ評価を実施。Semgrep/SonarQubeによるSAST分析、OWASP ZAPによるDASTスキャン、Snyk/Trivyによる依存関係監査、GitLeaks/TruffleHogによるシークレット検出を実行。サプライチェーン分析のためのSBOMを生成。OWASP Top 10脆弱性、CWE弱点、CVE露出を特定。」
- 出力: CVSSスコア、悪用可能性分析、攻撃面マッピング、シークレット露出レポート、SBOMインベントリを含む詳細な脆弱性レポート
- コンテキスト: すべての修復作業の初期ベースライン

### 2. 脅威モデリングとリスク分析
- subagent_type="security-auditor"でTaskツールを使用
- プロンプト: 「$ARGUMENTSに対してSTRIDE方法論を使用した脅威モデリングを実施。攻撃ベクトルを分析し、攻撃ツリーを作成し、特定された脆弱性のビジネス影響を評価。脅威をMITRE ATT&CKフレームワークにマッピング。可能性と影響に基づいてリスクを優先順位付け。」
- 出力: 脅威モデル図、優先順位付けされた脆弱性を含むリスクマトリックス、攻撃シナリオドキュメント、ビジネス影響分析
- コンテキスト: 脅威の優先順位を通知するために脆弱性スキャン結果を使用

### 3. アーキテクチャセキュリティレビュー
- subagent_type="backend-api-security::backend-architect"でTaskツールを使用
- プロンプト: 「$ARGUMENTSのアーキテクチャのセキュリティ弱点をレビュー。サービス境界、データフローセキュリティ、認証/認可アーキテクチャ、暗号化実装、ネットワークセグメンテーションを評価。ゼロトラストアーキテクチャパターンを設計。脅威モデルと脆弱性発見を参照。」
- 出力: セキュリティアーキテクチャ評価、ゼロトラスト設計推奨事項、サービスメッシュセキュリティ要件、データ分類マトリックス
- コンテキスト: アーキテクチャ脆弱性に対処するために脅威モデルを組み込む

## フェーズ2: 脆弱性修復

### 4. クリティカル脆弱性修正
- subagent_type="security-auditor"でTaskツールを使用
- プロンプト: 「$ARGUMENTSのクリティカル脆弱性（CVSS 7+）の即時修復を調整。パラメータ化されたクエリによるSQLインジェクション、出力エンコーディングによるXSS、セキュアセッション管理による認証バイパス、入力検証による安全でない逆シリアル化を修正。CVEのセキュリティパッチを適用。」
- 出力: 脆弱性修正を含むパッチ済みコード、セキュリティパッチドキュメント、リグレッションテスト要件
- コンテキスト: 脆弱性評価からの高優先度項目に対処

### 5. バックエンドセキュリティ強化
- subagent_type="backend-api-security::backend-security-coder"でTaskツールを使用
- プロンプト: 「$ARGUMENTSのための包括的なバックエンドセキュリティ制御を実装。OWASP ESAPIによる入力検証、レート制限とDDoS保護を追加、OAuth2/JWT検証によるAPIエンドポイントの保護、AES-256/TLS 1.3を使用した保存時/転送中データの暗号化を追加。PII露出のないセキュアロギングを実装。」
- 出力: 強化されたAPIエンドポイント、検証ミドルウェア、暗号化実装、セキュア設定テンプレート
- コンテキスト: 予防制御による脆弱性修正に基づく

### 6. フロントエンドセキュリティ実装
- subagent_type="frontend-mobile-security::frontend-security-coder"でTaskツールを使用
- プロンプト: 「$ARGUMENTSのためのフロントエンドセキュリティ対策を実装。nonceベースポリシーによるCSPヘッダーを設定、DOMPurifyによるXSS防止を実装、PKCE OAuth2によるセキュア認証フローを追加、外部リソースのSRIを追加、SameSite/HttpOnly/Secureフラグによるセキュアクッキー処理を実装。」
- 出力: セキュアフロントエンドコンポーネント、CSPポリシー設定、認証フロー実装、セキュリティヘッダー設定
- コンテキスト: クライアント側保護によるバックエンドセキュリティを補完

### 7. モバイルセキュリティ強化
- subagent_type="frontend-mobile-security::mobile-security-coder"でTaskツールを使用
- プロンプト: 「$ARGUMENTSのためのモバイルアプリセキュリティを実装。証明書ピンニングを追加、生体認証を実装、暗号化によるローカルストレージの保護、ProGuard/R8によるコード難読化、改ざん防止およびroot/jailbreak検出を実装、IPCコミュニケーションの保護。」
- 出力: 強化されたモバイルアプリケーション、セキュリティ設定ファイル、難読化ルール、証明書ピンニング実装
- コンテキスト: 該当する場合はモバイルプラットフォームにセキュリティを拡張

## フェーズ3: セキュリティ制御実装

### 8. 認証・認可の強化
- subagent_type="security-auditor"でTaskツールを使用
- プロンプト: 「$ARGUMENTSのための最新の認証システムを実装。PKCEによるOAuth2/OIDCをデプロイ、TOTP/WebAuthn/FIDO2によるMFAを実装、リスクベース認証を追加、最小権限原則によるRBAC/ABACを実装、セキュアトークンローテーションによるセッション管理を追加。」
- 出力: 認証サービス設定、MFA実装、認可ポリシー、セッション管理システム
- コンテキスト: アーキテクチャレビューに基づくアクセス制御の強化

### 9. インフラストラクチャセキュリティ制御
- subagent_type="deployment-strategies::deployment-engineer"でTaskツールを使用
- プロンプト: 「$ARGUMENTSのためのインフラストラクチャセキュリティ制御をデプロイ。OWASP保護のためのWAFルールを設定、マイクロセグメンテーションによるネットワークセグメンテーションを実装、IDS/IPSシステムをデプロイ、クラウドセキュリティグループとNACLを設定、レート制限とジオブロッキングによるDDoS保護を実装。」
- 出力: WAF設定、ネットワークセキュリティポリシー、IDS/IPSルール、クラウドセキュリティ設定
- コンテキスト: ネットワークレベルの防御を実装

### 10. シークレット管理実装
- subagent_type="deployment-strategies::deployment-engineer"でTaskツールを使用
- プロンプト: 「$ARGUMENTSのためのエンタープライズシークレット管理を実装。HashiCorp VaultまたはAWS Secrets Managerをデプロイ、シークレットローテーションポリシーを実装、ハードコードされたシークレットを削除、最小権限IAMロールを設定、HSMサポートによる暗号化鍵管理を実装。」
- 出力: シークレット管理設定、ローテーションポリシー、IAMロール定義、鍵管理手順
- コンテキスト: シークレット露出脆弱性を排除

## フェーズ4: 検証とコンプライアンス

### 11. ペネトレーションテストと検証
- subagent_type="security-auditor"でTaskツールを使用
- プロンプト: 「$ARGUMENTSのための包括的なペネトレーションテストを実行。認証済みおよび未認証テスト、APIセキュリティテスト、ビジネスロジックテスト、特権エスカレーション試行を実施。Burp Suite、Metasploit、カスタムエクスプロイトを使用。すべてのセキュリティ制御の有効性を検証。」
- 出力: ペネトレーションテストレポート、概念実証エクスプロイト、修復検証、セキュリティ制御有効性メトリクス
- コンテキスト: 実装されたすべてのセキュリティ対策を検証

### 12. コンプライアンスと標準検証
- subagent_type="security-auditor"でTaskツールを使用
- プロンプト: 「$ARGUMENTSのセキュリティフレームワークとのコンプライアンスを検証。OWASP ASVSレベル2、CISベンチマーク、SOC2 Type II要件、GDPR/CCPAプライバシー制御、該当する場合はHIPAA/PCI-DSSに対して検証。コンプライアンス証明レポートを生成。」
- 出力: コンプライアンス評価レポート、ギャップ分析、修復要件、監査証拠収集
- コンテキスト: 規制および業界標準のコンプライアンスを確保

### 13. セキュリティ監視とSIEM統合
- subagent_type="incident-response::devops-troubleshooter"でTaskツールを使用
- プロンプト: 「$ARGUMENTSのためのセキュリティ監視とSIEMを実装。Splunk/ELK/Sentinel統合をデプロイ、セキュリティイベント相関を設定、異常検知のための行動分析を実装、自動インシデント対応プレイブックを設定、セキュリティダッシュボードとアラートを作成。」
- 出力: SIEM設定、相関ルール、インシデント対応プレイブック、セキュリティダッシュボード、アラート定義
- コンテキスト: 継続的セキュリティ監視を確立

## 設定オプション
- scanning_depth: "quick" | "standard" | "comprehensive"（デフォルト: comprehensive）
- compliance_frameworks: ["OWASP", "CIS", "SOC2", "GDPR", "HIPAA", "PCI-DSS"]
- remediation_priority: "cvss_score" | "exploitability" | "business_impact"
- monitoring_integration: "splunk" | "elastic" | "sentinel" | "custom"
- authentication_methods: ["oauth2", "saml", "mfa", "biometric", "passwordless"]

## 成功基準
- すべてのクリティカル脆弱性（CVSS 7+）を修復
- OWASP Top 10脆弱性に対処
- ペネトレーションテストで高リスク発見がゼロ
- コンプライアンスフレームワーク検証に合格
- セキュリティ監視が脅威を検出しアラート
- クリティカルアラートのインシデント対応時間 < 15分
- SBOMを生成し脆弱性を追跡
- すべてのシークレットをセキュアボールトで管理
- 認証がMFAとセキュアセッション管理を実装
- セキュリティテストがCI/CDパイプラインに統合

## 調整ノート
- 各フェーズは後続フェーズに情報を提供する詳細な発見を提供
- security-auditorエージェントが修正のためにドメイン固有エージェントと調整
- すべてのコード変更は実装前にセキュリティレビューを受ける
- 評価と修復の間の継続的フィードバックループ
- セキュリティ発見は集中脆弱性管理システムで追跡
- 実装後の定期的なセキュリティレビューをスケジュール

セキュリティ強化ターゲット: $ARGUMENTS
