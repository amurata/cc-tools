> **[English](../../../../plugins/incident-response/commands/incident-response.md) | 日本語**

迅速な解決と学習のための最新のSREプラクティスを用いたマルチエージェントインシデント対応を調整します：

[拡張思考: このワークフローは、最新のSRE原則に従った包括的なインシデントコマンドシステム (ICS) を実装します。複数の専門エージェントが定義されたフェーズを通じて協力します：検出/トリアージ、調査/緩和、コミュニケーション/調整、解決/事後検証。ワークフローは精度を犠牲にすることなく速度を強調し、明確なコミュニケーションチャネルを維持し、ブレームレスな事後検証と体系的な改善を通じてすべてのインシデントが学習の機会となることを保証します。]

## 設定

### 重要度レベル
- **P0/SEV-1**: 完全停止、セキュリティ侵害、データ損失 - 即座の全員対応
- **P1/SEV-2**: 主要な劣化、重大なユーザー影響 - 迅速な対応が必要
- **P2/SEV-3**: マイナーな劣化、限定的な影響 - 標準対応
- **P3/SEV-4**: 表面的な問題、ユーザー影響なし - スケジュールされた解決

### インシデントタイプ
- パフォーマンス劣化
- サービス停止
- セキュリティインシデント
- データ整合性問題
- インフラストラクチャ障害
- サードパーティサービスの中断

## フェーズ1: 検出とトリアージ

### 1. インシデント検出と分類
- Taskツールをsubagent_type="incident-responder"で使用
- プロンプト: "緊急: インシデントを検出し分類: $ARGUMENTS。PagerDuty/Opsgenie/監視からのアラートを分析。決定: 1) インシデント重要度 (P0-P3)、2) 影響を受けたサービスと依存関係、3) ユーザー影響とビジネスリスク、4) 必要な初期インシデントコマンド構造。エラーバジェットとSLO違反を確認。"
- 出力: 重要度分類、影響評価、インシデントコマンド割り当て、SLOステータス
- コンテキスト: 初期アラート、監視ダッシュボード、最近の変更

### 2. 可観測性分析
- Taskツールをsubagent_type="observability-monitoring::observability-engineer"で使用
- プロンプト: "インシデントの迅速な可観測性スイープを実行: $ARGUMENTS。クエリ: 1) 分散トレーシング (OpenTelemetry/Jaeger)、2) メトリクス相関 (Prometheus/Grafana/DataDog)、3) ログ集約 (ELK/Splunk)、4) APMデータ、5) リアルユーザーモニタリング。異常、エラーパターン、サービス劣化ポイントを識別。"
- 出力: 可観測性の発見、異常検出、サービス健全性マトリックス、トレース分析
- コンテキスト: ステップ1からの重要度レベル、影響を受けたサービス

### 3. 初期緩和
- Taskツールをsubagent_type="incident-responder"で使用
- プロンプト: "P$SEVERITYインシデントの即座の緩和を実装: $ARGUMENTS。アクション: 1) 必要に応じてトラフィックスロットリング/再ルーティング、2) 影響を受けた機能の機能フラグ無効化、3) サーキットブレーカーのアクティベーション、4) 最近のデプロイメントのロールバック評価、5) 容量関連の場合はリソースのスケール。ユーザー体験の復旧を優先。"
- 出力: 実行された緩和アクション、適用された一時的な修正、ロールバック決定
- コンテキスト: 可観測性の発見、重要度分類

## フェーズ2: 調査と根本原因分析

### 4. 深層システムデバッグ
- Taskツールをsubagent_type="error-debugging::debugger"で使用
- プロンプト: "可観測性データを使用してインシデントの深層デバッグを実施: $ARGUMENTS。調査: 1) スタックトレースとエラーログ、2) データベースクエリパフォーマンスとロック、3) ネットワークレイテンシーとタイムアウト、4) メモリリークとCPUスパイク、5) 依存関係の障害とカスケードエラー。5つのなぜ分析を適用。"
- 出力: 根本原因の識別、貢献要因、依存関係影響マップ
- コンテキスト: 可観測性分析、緩和ステータス

### 5. セキュリティ評価
- Taskツールをsubagent_type="security-scanning::security-auditor"で使用
- プロンプト: "インシデントのセキュリティ影響を評価: $ARGUMENTS。確認: 1) DDoS攻撃の兆候、2) 認証/認可の失敗、3) データ露出リスク、4) 証明書の問題、5) 疑わしいアクセスパターン。WAFログ、セキュリティグループ、監査証跡をレビュー。"
- 出力: セキュリティ評価、侵害分析、脆弱性識別
- コンテキスト: 根本原因の発見、システムログ

### 6. パフォーマンスエンジニアリング分析
- Taskツールをsubagent_type="application-performance::performance-engineer"で使用
- プロンプト: "インシデントのパフォーマンス側面を分析: $ARGUMENTS。調査: 1) リソース使用パターン、2) クエリ最適化の機会、3) キャッシングの効果、4) ロードバランサーの健全性、5) CDNパフォーマンス、6) オートスケーリングトリガー。ボトルネックと容量問題を識別。"
- 出力: パフォーマンスボトルネック、リソース推奨事項、最適化の機会
- コンテキスト: デバッグの発見、現在の緩和状態

## フェーズ3: 解決と復旧

### 7. 修正実装
- Taskツールをsubagent_type="backend-development::backend-architect"で使用
- プロンプト: "根本原因に基づいてインシデントの本番修正を設計し実装: $ARGUMENTS。要件: 1) 迅速なデプロイのための最小実行可能な修正、2) リスク評価とロールバック能力、3) 監視を伴う段階的ロールアウト計画、4) 検証基準と健全性チェック。即座の修正と長期的な解決策の両方を考慮。"
- 出力: 修正実装、デプロイメント戦略、検証計画、ロールバック手順
- コンテキスト: 根本原因分析、パフォーマンスの発見、セキュリティ評価

### 8. デプロイメントと検証
- Taskツールをsubagent_type="deployment-strategies::deployment-engineer"で使用
- プロンプト: "インシデント修正の緊急デプロイメントを実行: $ARGUMENTS。プロセス: 1) ブルーグリーンまたはカナリアデプロイメント、2) 監視を伴う段階的ロールアウト、3) 各段階での健全性チェック検証、4) ロールバックトリガーの設定、5) デプロイメント中のリアルタイム監視。インシデントコマンドと調整。"
- 出力: デプロイメントステータス、検証結果、監視ダッシュボード、ロールバック準備
- コンテキスト: 修正実装、現在のシステム状態

## フェーズ4: コミュニケーションと調整

### 9. ステークホルダーコミュニケーション
- Taskツールをsubagent_type="content-marketing::content-marketer"で使用
- プロンプト: "インシデントコミュニケーションを管理: $ARGUMENTS。作成: 1) ステータスページ更新 (公開向け)、2) 内部エンジニアリング更新 (技術的詳細)、3) 役員サマリー (ビジネス影響/ETA)、4) カスタマーサポートブリーフィング (トーキングポイント)、5) 主要決定を含むタイムラインドキュメント。重要度に基づいて15-30分ごとに更新。"
- 出力: コミュニケーション成果物、ステータス更新、ステークホルダーブリーフィング、タイムラインログ
- コンテキスト: すべての前のフェーズ、現在の解決ステータス

### 10. 顧客影響評価
- Taskツールをsubagent_type="incident-responder"で使用
- プロンプト: "インシデントの顧客影響を評価しドキュメント化: $ARGUMENTS。分析: 1) 影響を受けたユーザーセグメントと地域、2) 失敗したトランザクションまたはデータ損失、3) SLA違反と契約上の影響、4) カスタマーサポートチケット量、5) 収益影響の推定。積極的な顧客アウトリーチリストを準備。"
- 出力: 顧客影響レポート、SLA分析、アウトリーチ推奨事項
- コンテキスト: 解決進捗、コミュニケーションステータス

## フェーズ5: 事後検証と防止

### 11. ブレームレスな事後検証
- Taskツールをsubagent_type="documentation-generation::docs-architect"で使用
- プロンプト: "インシデントのブレームレスな事後検証を実施: $ARGUMENTS。ドキュメント化: 1) 決定を含む完全なインシデントタイムライン、2) 根本原因と貢献要因 (システムフォーカス)、3) 対応でうまくいったこと、4) 改善できること、5) オーナーと期限を含むアクションアイテム、6) チーム教育のための学んだ教訓。SRE事後検証のベストプラクティスに従う。"
- 出力: 事後検証ドキュメント、アクションアイテムリスト、プロセス改善、トレーニングニーズ
- コンテキスト: 完全なインシデント履歴、すべてのエージェント出力

### 12. 監視とアラートの強化
- Taskツールをsubagent_type="observability-monitoring::observability-engineer"で使用
- プロンプト: "再発を防ぐための監視を強化: $ARGUMENTS。実装: 1) 早期検出のための新しいアラート、2) 必要に応じてSLI/SLOの調整、3) 可視性のためのダッシュボード改善、4) ランブック自動化の機会、5) テストのためのカオスエンジニアリングシナリオ。アラートが実行可能でノイズを削減することを保証。"
- 出力: 新しい監視設定、アラートルール、ダッシュボード更新、ランブック自動化
- コンテキスト: 事後検証の発見、根本原因分析

### 13. システム強化
- Taskツールをsubagent_type="backend-development::backend-architect"で使用
- プロンプト: "インシデントを防ぐためのシステム改善を設計: $ARGUMENTS。提案: 1) レジリエンスのためのアーキテクチャ変更 (サーキットブレーカー、バルクヘッド)、2) グレースフルデグラデーション戦略、3) キャパシティプランニングの調整、4) 技術的負債の優先順位付け、5) 依存関係削減の機会。実装ロードマップを作成。"
- 出力: アーキテクチャ改善、レジリエンスパターン、技術的負債アイテム、ロードマップ
- コンテキスト: 事後検証アクションアイテム、パフォーマンス分析

## 成功基準

### 即座の成功 (インシデント中)
- SLAターゲット内でのサービス復旧
- 5分以内の正確な重要度分類
- 15-30分ごとのステークホルダーコミュニケーション
- カスケード障害やインシデントのエスカレーションなし
- 明確なインシデントコマンド構造の維持

### 長期的な成功 (インシデント後)
- 48時間以内の包括的な事後検証
- 期限付きで割り当てられたすべてのアクションアイテム
- 1週間以内にデプロイされた監視改善
- 完了したランブック更新
- 学んだ教訓に関するチームトレーニングの実施
- エラーバジェット影響の評価と伝達

## 調整プロトコル

### インシデントコマンド構造
- **インシデントコマンダー**: 決定権限、調整
- **テクニカルリード**: 技術的調査と解決
- **コミュニケーションリード**: ステークホルダー更新
- **サブジェクトマターエキスパート**: 特定のシステム専門知識

### コミュニケーションチャネル
- ウォールーム (SlackまたはTeamsチャネル、Zoom)
- ステータスページ更新 (StatusPage、Statusly)
- アラートのためのPagerDuty/Opsgenie
- ドキュメント化のためのConfluence/Notion

### ハンドオフ要件
- 各フェーズは次のフェーズに明確なコンテキストを提供
- すべての発見を共有インシデントドキュメントに文書化
- 事後検証のために記録された決定の根拠
- すべての重要なイベントにタイムスタンプ

即座の対応が必要な本番インシデント: $ARGUMENTS
